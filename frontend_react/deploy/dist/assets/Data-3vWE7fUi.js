import{u as W,j as a,B as _,F as N,r as x,R as U,I as J,l as L,a as X,b as Y,c as Z,d as ee,e as b,D as p,f as ae,g as se,S as te}from"./index-DiWjiFh-.js";import{f as q,u as ne,L as Q,a as ie,S as re}from"./loading-pLm4XZci.js";import{T as $,a as K,b as T,c as C,d as H,e as M,f as le,g as ce,h as oe,i as z}from"./tabs-Bms1vmIb.js";const de=({onClear:e})=>{const{mutate:t}=W(),l=()=>{t(),e&&e()};return a.jsxs(_,{variant:"ghost",onClick:l,children:[a.jsx(N,{icon:q.faTrash}),"Clear all datasets"]})};var E={},F;function fe(){return F||(F=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});var t="fas",l="download",c=512,n=512,i=[],r="f019",s="M288 32c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 242.7-73.4-73.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l128 128c12.5 12.5 32.8 12.5 45.3 0l128-128c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L288 274.7 288 32zM64 352c-35.3 0-64 28.7-64 64l0 32c0 35.3 28.7 64 64 64l384 0c35.3 0 64-28.7 64-64l0-32c0-35.3-28.7-64-64-64l-101.5 0-45.3 45.3c-25 25-65.5 25-90.5 0L165.5 352 64 352zm368 56a24 24 0 1 1 0 48 24 24 0 1 1 0-48z";e.definition={prefix:t,iconName:l,icon:[c,n,i,r,s]},e.faDownload=e.definition,e.prefix=t,e.iconName=l,e.width=c,e.height=n,e.ligatures=i,e.unicode=r,e.svgPathData=s,e.aliases=i}(E)),E}var ue=fe();const A=({initialValue:e,rowIndex:t,field:l,onUpdate:c})=>{const[n,i]=x.useState(!1),[r,s]=x.useState(e);U.useEffect(()=>{s(e)},[e]);const d=()=>{i(!0)},g=()=>{i(!1),r!==e&&c&&c(t,l,r)},h=f=>{f.key==="Enter"?(f.preventDefault(),i(!1),r!==e&&c&&c(t,l,r)):f.key==="Escape"&&(i(!1),s(e))};return n?a.jsx(J,{value:r,onChange:f=>s(f.target.value),onBlur:g,onKeyDown:h,autoFocus:!0,className:"w-full h-[28px]"}):a.jsx("div",{onDoubleClick:d,className:"cursor-pointer hover:bg-secondary p-1 rounded min-h-[28px]",title:"Double-click to edit",children:r})},he=({data:e,onUpdateCell:t})=>{var c;const l=(n,i,r)=>{t&&t(n,i,r)};return a.jsxs($,{children:[a.jsx(K,{className:"bg-background",children:a.jsxs(T,{children:[a.jsx(C,{className:"w-[200px]",children:"Column"}),a.jsx(C,{children:"Type"}),a.jsx(C,{children:"Description"})]})}),a.jsx(H,{children:(c=e.column_descriptions)==null?void 0:c.map((n,i)=>a.jsxs(T,{children:[a.jsx(M,{className:"font-medium",children:n.column}),a.jsx(M,{children:a.jsx(A,{initialValue:n.data_type,rowIndex:i,field:"data_type",onUpdate:l})}),a.jsx(M,{children:a.jsx(A,{initialValue:n.description,rowIndex:i,field:"description",onUpdate:l})})]},n.column))})]})};var I=new Map,y=new WeakMap,O=0,ge=void 0;function me(e){return e?(y.has(e)||(O+=1,y.set(e,O.toString())),y.get(e)):"0"}function xe(e){return Object.keys(e).sort().filter(t=>e[t]!==void 0).map(t=>`${t}_${t==="root"?me(e.root):e[t]}`).toString()}function ve(e){const t=xe(e);let l=I.get(t);if(!l){const c=new Map;let n;const i=new IntersectionObserver(r=>{r.forEach(s=>{var d;const g=s.isIntersecting&&n.some(h=>s.intersectionRatio>=h);e.trackVisibility&&typeof s.isVisible>"u"&&(s.isVisible=g),(d=c.get(s.target))==null||d.forEach(h=>{h(g,s)})})},e);n=i.thresholds||(Array.isArray(e.threshold)?e.threshold:[e.threshold||0]),l={id:t,observer:i,elements:c},I.set(t,l)}return l}function je(e,t,l={},c=ge){if(typeof window.IntersectionObserver>"u"&&c!==void 0){const d=e.getBoundingClientRect();return t(c,{isIntersecting:c,target:e,intersectionRatio:typeof l.threshold=="number"?l.threshold:0,time:0,boundingClientRect:d,intersectionRect:d,rootBounds:d}),()=>{}}const{id:n,observer:i,elements:r}=ve(l),s=r.get(e)||[];return r.has(e)||r.set(e,s),s.push(t),i.observe(e),function(){s.splice(s.indexOf(t),1),s.length===0&&(r.delete(e),i.unobserve(e)),r.size===0&&(i.disconnect(),I.delete(n))}}function Ne({threshold:e,delay:t,trackVisibility:l,rootMargin:c,root:n,triggerOnce:i,skip:r,initialInView:s,fallbackInView:d,onChange:g}={}){var h;const[f,v]=x.useState(null),o=x.useRef(g),[u,m]=x.useState({inView:!!s,entry:void 0});o.current=g,x.useEffect(()=>{if(r||!f)return;let D;return D=je(f,(k,S)=>{m({inView:k,entry:S}),o.current&&o.current(k,S),S.isIntersecting&&i&&D&&(D(),D=void 0)},{root:n,rootMargin:c,threshold:e,trackVisibility:l,delay:t},d),()=>{D&&D()}},[Array.isArray(e)?e.toString():e,f,n,c,i,r,l,d,t]);const w=(h=u.entry)==null?void 0:h.target,B=x.useRef(void 0);!f&&w&&!i&&!r&&B.current!==w&&(B.current=w,m({inView:!!s,entry:void 0}));const j=[v,u.inView,u.entry];return j.ref=j[0],j.inView=j[1],j.entry=j[2],j}const we=({datasetName:e,rowsPerPage:t=50})=>{const{ref:l,inView:c}=Ne(),{data:n,fetchNextPage:i,hasNextPage:r,isFetchingNextPage:s,status:d,isError:g,error:h}=ne(e,t);x.useEffect(()=>{c&&r&&!s&&i()},[c,i,r,s]);const f=x.useMemo(()=>n?n.pages.flatMap(o=>o.dataset.data_records):[],[n]),v=x.useMemo(()=>{var o,u;return!n||!((u=(o=n.pages[0])==null?void 0:o.dataset)!=null&&u.data_records[0])?[]:Object.keys(n.pages[0].dataset.data_records[0])},[n]);return d==="pending"?a.jsx("div",{className:"h-96",children:a.jsx(Q,{})}):g?a.jsxs("div",{className:"flex flex-col flex-1 items-center justify-center h-96",children:["Error loading data: ",String(h)]}):f.length===0?a.jsx("div",{className:"flex flex-col flex-1 items-center justify-center h-96",children:"No data available for this dataset."}):a.jsxs("div",{className:"w-full overflow-auto",children:[a.jsxs($,{children:[a.jsx(K,{className:"bg-background",children:a.jsx(T,{children:v.map(o=>a.jsx(C,{children:o},o))})}),a.jsx(H,{children:f.map((o,u)=>a.jsx(T,{children:v.map(m=>a.jsx(M,{children:o[m]!==null&&o[m]!==void 0?String(o[m]):""},m))},u))})]}),a.jsx("div",{ref:l,className:"w-full text-center p-4",children:s?a.jsxs("div",{className:"flex justify-center items-center",children:[a.jsx("img",{src:L,alt:"processing",className:"mr-2 w-4 h-4 animate-spin"}),a.jsx("span",{className:"ml-2",children:"Loading more..."})]}):r?a.jsx("div",{className:"h-10"}):a.jsx("div",{className:"text-muted-foreground",children:f.length>0?"End of data":"No data available"})})]})},De=({dictionary:e,isProcessing:t=!0,viewMode:l="description"})=>{var f,v;const{mutate:c}=X(),{mutate:n}=Y(),{mutate:i,isPending:r}=Z(),{data:s,isLoading:d}=ie(e.name),g=o=>{if(o===0)return"0 Bytes";const u=1024,m=["Bytes","KB","MB","GB","TB"],w=Math.floor(Math.log(o)/Math.log(u));return parseFloat((o/Math.pow(u,w)).toFixed(2))+" "+m[w]},h=s!=null&&s.file_size?g(s.file_size):"0 MB";return a.jsxs("div",{className:ee("flex flex-col w-full bg-card p-4",{"h-[400px]":t}),children:[a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg",children:a.jsx("strong",{children:e.name})}),a.jsxs("div",{className:"flex justify-between pt-1",children:[a.jsxs("div",{className:"flex gap-2 my-1",children:[a.jsx(b,{variant:"secondary",className:"leading-tight text-sm",children:d?"Loading...":`${((f=s==null?void 0:s.columns)==null?void 0:f.length)||0} features`}),a.jsx(b,{variant:"secondary",className:"leading-tight text-sm",children:d?"Loading...":`${((v=s==null?void 0:s.row_count)==null?void 0:v.toLocaleString())||0} rows`}),a.jsx(b,{variant:"secondary",className:"leading-tight text-sm",children:d?"Loading...":h}),a.jsx(b,{variant:"secondary",className:"leading-tight text-sm",children:(s==null?void 0:s.data_source)||"file"}),t?a.jsxs(b,{variant:"outline",className:"leading-tight text-sm",children:[a.jsx("img",{src:L,alt:"processing",className:"mr-2 w-4 h-4 animate-spin"}),"Processing..."]}):a.jsxs(b,{variant:"success",className:"leading-tight text-sm",children:[a.jsx(N,{className:"mr-2 w-4 h-4 ",icon:le.faCheck}),"Processed"]})]}),a.jsxs("div",{className:"flex gap-2 px-2",children:[a.jsx(_,{variant:"link",onClick:()=>{i({name:e.name})},title:"Download dictionary as CSV",disabled:t||r,children:r?a.jsx("img",{src:L,alt:"downloading",className:"w-4 h-4 animate-spin"}):a.jsx(N,{icon:ue.faDownload})}),a.jsx(_,{variant:"link",onClick:()=>{c({name:e.name})},title:"Delete dictionary",children:a.jsx(N,{icon:q.faTrash})})]})]})]}),a.jsx("div",{className:"flex flex-col flex-1 text-lg",children:t?a.jsx("div",{className:"flex flex-col flex-1 items-center justify-center",children:"Processing the dataset may take a few minutes..."}):a.jsx(re,{className:"mt-4 h-96",children:l===p.DESCRIPTION?a.jsx(he,{data:e,onUpdateCell:(o,u,m)=>{n({name:e.name,rowIndex:o,field:u,value:m},{onError:()=>{}})}}):a.jsx(we,{datasetName:e.name,rowsPerPage:50})})})]})};var R={},G;function be(){return G||(G=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});var t="fas",l="quote-left",c=448,n=512,i=[8220,"quote-left-alt"],r="f10d",s="M0 216C0 149.7 53.7 96 120 96l8 0c17.7 0 32 14.3 32 32s-14.3 32-32 32l-8 0c-30.9 0-56 25.1-56 56l0 8 64 0c35.3 0 64 28.7 64 64l0 64c0 35.3-28.7 64-64 64l-64 0c-35.3 0-64-28.7-64-64l0-32 0-32 0-72zm256 0c0-66.3 53.7-120 120-120l8 0c17.7 0 32 14.3 32 32s-14.3 32-32 32l-8 0c-30.9 0-56 25.1-56 56l0 8 64 0c35.3 0 64 28.7 64 64l0 64c0 35.3-28.7 64-64 64l-64 0c-35.3 0-64-28.7-64-64l0-32 0-32 0-72z";e.definition={prefix:t,iconName:l,icon:[c,n,i,r,s]},e.faQuoteLeft=e.definition,e.prefix=t,e.iconName=l,e.width=c,e.height=n,e.ligatures=i,e.unicode=r,e.svgPathData=s,e.aliases=i}(R)),R}var pe=be();const ye=({defaultValue:e=p.DESCRIPTION,onChange:t})=>a.jsx(ce,{defaultValue:e,onValueChange:t,className:"w-fit py-4",children:a.jsxs(oe,{className:"grid w-full grid-cols-2",children:[a.jsxs(z,{value:p.DESCRIPTION,children:[a.jsx(N,{className:"mr-2",icon:pe.faQuoteLeft}),"Description"]}),a.jsxs(z,{value:p.RAW,children:[a.jsx(N,{className:"mr-2",icon:ae.faTable}),"Raw rows"]})]})});var P={},V;function Ce(){return V||(V=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});var t="fas",l="magnifying-glass",c=512,n=512,i=[128269,"search"],r="f002",s="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352a144 144 0 1 0 0-288 144 144 0 1 0 0 288z";e.definition={prefix:t,iconName:l,icon:[c,n,i,r,s]},e.faMagnifyingGlass=e.definition,e.prefix=t,e.iconName=l,e.width=c,e.height=n,e.ligatures=i,e.unicode=r,e.svgPathData=s,e.aliases=i}(P)),P}var Me=Ce();const Te=()=>a.jsxs("div",{children:[a.jsx(N,{className:"mx-2",icon:Me.faMagnifyingGlass}),"Search"]}),Pe=()=>{const{data:e,status:t}=se(),[l,c]=x.useState(p.DESCRIPTION);return a.jsxs("div",{className:"p-6",children:[a.jsx("h2",{className:"text-xl",children:a.jsx("strong",{children:"Data"})}),a.jsxs("div",{className:"flex justify-between gap-2",children:[a.jsxs("div",{className:"flex gap-2 items-center",children:[a.jsx("div",{className:"text-sm",children:"View"}),a.jsx(ye,{defaultValue:l,onChange:n=>c(n)}),a.jsx(Te,{})]}),a.jsx("div",{className:"flex items-center",children:a.jsx(de,{})})]}),a.jsx(te,{className:"my-4 border-t"}),t==="pending"?a.jsx("div",{className:"flex items-center justify-center h-[calc(100vh-200px)]",children:a.jsx(Q,{})}):a.jsx("div",{className:"flex flex-col gap-4",children:e==null?void 0:e.map(n=>a.jsx(De,{isProcessing:n.in_progress||!1,dictionary:n,viewMode:l},n.name))})]})};export{Pe as Data};
